# https://github.com/github/codeql-action/blob/main/init/action.yml
# https://github.com/github/codeql-action/blob/main/analyze/action.yml
name: 'CodeQL'
description: 'Run CodeQL analysis'
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - uses: ./.github/actions/setup-java
    - uses: github/codeql-action/init@v2
      with:
        languages: kotlin
        queries: security-and-quality
        setup-python-dependencies: false
    - name: Run gradle assemble testClasses
      uses: gradle/gradle-build-action@v2.8.0
      with:
        gradle-version: wrapper
        arguments: clean assemble testClasses --no-build-cache
        # The documentation wants us to disable cache: https://docs.github.com/en/code-security/code-scanning/troubleshooting-code-scanning/no-source-code-seen-during-build
        cache-disabled: true
    - uses: github/codeql-action/analyze@v2
      with:
        category: "/language:kotlin"
