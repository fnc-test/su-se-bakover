name: Build non-master/main branches on push.
# If you want to deploy your branch see branch-deploy.yml

on:
  push:
    branches:
      - '*'         # matches every branch that doesn't contain a '/'
      - '*/*'       # matches every branch containing a single '/'
      - '**'        # matches every branch
      - '!master'   # excludes master
      - '!main'     # excludes main (will probably replace master)
    paths-ignore:
      - '.github/workflows/datapakker.yml'
      - 'datapakker/**'

env:
  IMAGE: ghcr.io/${{ github.repository }}/su-se-bakover:${{ github.sha }}

jobs:
  build_and_test:
    if: ${{!contains(github.event.head_commit.message, '--skip_tests')}}
    uses: ./.github/workflows/build.yml

  build:
    if: contains(github.event.head_commit.message, '--skip_tests')
    uses: ./.github/workflows/build.yml
    with:
      withoutTests: true
